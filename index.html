<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Animal Match Studio</title>
  <meta name="description" content="Playful animal vibe matcher and dinner idea generator. Built with Teachable Machine, designed for quick inspiration." />
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1914553061937911" crossorigin="anonymous"></script>
  <style>
    :root{
      --bg1:#050814;
      --bg2:#0a1240;

      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --line: rgba(255,255,255,0.14);

      --card: rgba(255,255,255,0.10);
      --shadow: 0 18px 60px rgba(0,0,0,0.40);
      --control-bg: rgba(10,14,28,0.55);
      --radius: 20px;

      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans", sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px;

      /* COLORFUL BACKGROUND */
      background:
        radial-gradient(900px 600px at 10% 10%, rgba(255, 90, 150, 0.28), transparent 60%),
        radial-gradient(900px 650px at 90% 15%, rgba(90, 200, 255, 0.24), transparent 58%),
        radial-gradient(1000px 720px at 55% 95%, rgba(120, 255, 150, 0.18), transparent 60%),
        radial-gradient(900px 650px at 85% 85%, rgba(255, 220, 90, 0.14), transparent 60%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 70%, #050713 100%);
      overflow-x:hidden;
    }

    body[data-theme="light"]{
      --bg1:#f3f6ff;
      --bg2:#eaf2ff;
      --text: rgba(12,16,24,0.92);
      --muted: rgba(12,16,24,0.62);
      --line: rgba(12,16,24,0.16);
      --card: rgba(255,255,255,0.78);
      --shadow: 0 18px 60px rgba(18,22,38,0.16);
      --control-bg: rgba(255,255,255,0.85);

      background:
        radial-gradient(900px 600px at 10% 10%, rgba(255, 140, 200, 0.20), transparent 60%),
        radial-gradient(900px 650px at 90% 15%, rgba(90, 180, 255, 0.20), transparent 58%),
        radial-gradient(1000px 720px at 55% 95%, rgba(140, 255, 190, 0.18), transparent 60%),
        radial-gradient(900px 650px at 85% 85%, rgba(255, 220, 120, 0.18), transparent 60%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 70%, #f6f8ff 100%);
    }

    .wrap{ width: min(760px, 100%); }

    .card{
      position:relative;
      padding: 22px;
      border-radius: 30px;
      border: 1px solid var(--line);
      background: var(--card);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* extra colorful glow */
    .glow{
      position:absolute;
      inset:-160px -180px auto auto;
      width:520px;
      height:520px;
      border-radius:50%;
      background:
        radial-gradient(circle at 25% 25%, rgba(255,90,150,0.25), transparent 55%),
        radial-gradient(circle at 70% 35%, rgba(90,200,255,0.22), transparent 60%),
        radial-gradient(circle at 55% 75%, rgba(120,255,150,0.18), transparent 62%),
        radial-gradient(circle at 35% 75%, rgba(255,220,90,0.14), transparent 62%);
      filter: blur(1px);
      pointer-events:none;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
      margin-bottom: 14px;
    }

    h1{
      margin:0;
      font-size: clamp(22px, 3vw, 30px);
      letter-spacing:-0.4px;
      line-height:1.15;
    }
    .sub{
      margin: 8px 0 0;
      color: var(--muted);
      line-height:1.7;
      font-size: 14px;
      max-width: 60ch;
    }

    /* Replaced "index.html · offline OK" badge */
    .badge{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background:
        linear-gradient(135deg, rgba(255,90,150,0.22), rgba(90,200,255,0.18), rgba(120,255,150,0.16));
      box-shadow: 0 10px 22px rgba(0,0,0,0.25);
      white-space:nowrap;
    }

    .badge-stack{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap: 8px;
    }

    .theme-btn{
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      background: rgba(255,255,255,0.08);
    }

    body[data-theme="light"] .badge{
      color: rgba(12,16,24,0.86);
      border-color: rgba(12,16,24,0.18);
    }

    body[data-theme="light"] .setLabel{
      color: rgba(12,16,24,0.76);
      border-color: rgba(12,16,24,0.18);
      background: rgba(12,16,24,0.06);
    }

    body[data-theme="light"] .dish{
      color: rgba(12,16,24,0.92);
      border-color: rgba(12,16,24,0.18);
      background: rgba(255,255,255,0.9);
      box-shadow: 0 12px 26px rgba(18,22,38,0.14);
    }

    .panel{
      display:grid;
      gap: 14px;
      margin-top: 14px;
    }

    .site-nav{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      margin: 6px 0 8px;
    }

    .site-nav a{
      font-size: 12px;
      font-weight: 700;
      color: var(--text);
      text-decoration: none;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
    }

    .site-nav a:hover{
      background: rgba(255,255,255,0.12);
    }

    .about,
    .feature,
    .info,
    .policy,
    .faq{
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      display:grid;
      gap: 12px;
    }

    .about h2,
    .feature h2,
    .info h2,
    .policy h2,
    .faq h2{
      margin: 0;
      font-size: 18px;
      letter-spacing:-0.2px;
    }

    .about p,
    .feature p,
    .info p,
    .policy p,
    .faq p{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.7;
    }

    .info-grid{
      display:grid;
      gap: 12px;
    }

    .info-card{
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.22);
      display:grid;
      gap: 8px;
    }

    .info-card h3{
      margin: 0;
      font-size: 14px;
      letter-spacing:-0.2px;
    }

    .info-card p{
      margin: 0;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.6;
    }

    .policy-list,
    .faq-list{
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.7;
    }

    body[data-theme="light"] .site-nav a{
      color: rgba(12,16,24,0.9);
      border-color: rgba(12,16,24,0.16);
      background: rgba(12,16,24,0.06);
    }

    body[data-theme="light"] .info-card{
      border-color: rgba(12,16,24,0.14);
      background: rgba(255,255,255,0.9);
    }

    .menu{
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.06);
      min-height: 120px;
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    .hint{
      color: var(--muted);
      font-size: 13px;
      line-height:1.7;
    }

    .setRow{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
    }

    .setLabel{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,0.80);
      padding: 6px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.22);
      margin-right: 4px;
    }

    .dish{
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 700;
      border: 1px solid rgba(255,255,255,0.18);
      box-shadow: 0 12px 26px rgba(0,0,0,0.28);
      user-select:none;
      transform: translateY(0);
      transition: transform .12s ease, filter .12s ease;
      color: rgba(255,255,255,0.95);
      background: rgba(255,255,255,0.12);
    }
    .dish:hover{ transform: translateY(-1px); filter: brightness(1.05); }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
    }

    .left-controls{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.07);
      color: var(--text);
      font-weight: 800;
      font-size: 14px;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, opacity .12s ease, filter .12s ease;
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,0.12);
      filter: brightness(1.03);
    }

    .btn.primary{
      border-color: transparent;
      background: linear-gradient(135deg,
        rgba(255,90,150,0.40),
        rgba(255,220,90,0.30),
        rgba(90,200,255,0.34),
        rgba(120,255,150,0.28)
      );
      box-shadow: 0 14px 34px rgba(0,0,0,0.20);
    }

    .btn:disabled{
      opacity:0.55;
      cursor:not-allowed;
      transform:none;
      filter:none;
    }

    .link{
      color: rgba(255,255,255,0.92);
      text-decoration: none;
      border-bottom: 1px solid rgba(255,255,255,0.32);
    }
    .link:hover{
      border-bottom-color: rgba(255,255,255,0.75);
    }

    .opt{
      display:flex;
      gap:10px;
      align-items:center;
      color: var(--muted);
      font-size: 13px;
    }

    select{
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: var(--control-bg);
      color: var(--text);
      outline:none;
      font-size: 14px;
    }

    .meta{
      display:flex;
      flex-wrap:wrap;
      gap: 10px 14px;
      align-items:center;
      justify-content:space-between;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.10);
      margin-top: 6px;
      color: var(--muted);
      font-size: 12px;
    }
    .mono{ font-family: var(--mono); }

    .divider{
      height: 1px;
      margin: 14px 0 6px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.18), transparent);
      border: none;
    }

    .partner{
      margin-top: 14px;
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      display:grid;
      gap: 12px;
    }

    .animal{
      margin-top: 14px;
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      display:grid;
      gap: 14px;
    }

    .animal-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }

    .animal h2{
      margin: 0;
      font-size: 18px;
      letter-spacing:-0.2px;
    }

    .animal p{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
    }

    .animal-status{
      font-family: var(--mono);
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.22);
      color: rgba(255,255,255,0.86);
      white-space: nowrap;
    }

    .animal-controls{
      display:grid;
      gap: 12px;
    }

    .animal-buttons{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
    }

    .animal-preview{
      display:grid;
      gap: 12px;
    }

    .animal-preview img{
      width: min(360px, 100%);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.16);
      object-fit: cover;
      aspect-ratio: 3 / 4;
      background: rgba(0,0,0,0.25);
    }

    #animalPreview:not([src]),
    #animalPreview[src=""]{
      display:none;
    }

    .animal-results{
      display:grid;
      gap: 8px;
    }

    #animalImage{
      position: absolute;
      left: -9999px;
      opacity: 0;
      pointer-events: none;
    }

    .animal-result{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.22);
      font-size: 13px;
    }

    .animal-bar{
      flex: 1;
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.12);
      overflow:hidden;
    }

    .animal-bar span{
      display:block;
      height: 100%;
      background: linear-gradient(90deg, rgba(255,90,150,0.6), rgba(120,255,150,0.5), rgba(90,200,255,0.6));
    }

    body[data-theme="light"] .animal-status{
      color: rgba(12,16,24,0.86);
      border-color: rgba(12,16,24,0.18);
      background: rgba(12,16,24,0.06);
    }

    body[data-theme="light"] .animal-result{
      border-color: rgba(12,16,24,0.14);
      background: rgba(255,255,255,0.9);
    }

    .partner h2{
      margin: 0;
      font-size: 18px;
      letter-spacing:-0.2px;
    }

    .partner p{
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
    }

    .partner-form{
      display:grid;
      gap: 12px;
    }

    .partner-grid{
      display:grid;
      gap: 12px;
    }

    .field{
      display:grid;
      gap: 6px;
    }

    .field label{
      font-size: 12px;
      letter-spacing: 0.2px;
      text-transform: uppercase;
      color: var(--muted);
      font-weight: 700;
    }

    .field input,
    .field textarea,
    .field select{
      width: 100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: var(--control-bg);
      color: var(--text);
      outline: none;
      font-size: 14px;
    }

    .field input::placeholder,
    .field textarea::placeholder{
      color: rgba(255,255,255,0.62);
    }

    .field textarea{
      min-height: 120px;
      resize: vertical;
    }

    .partner-actions{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
    }

    .partner-status{
      display:none;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.28);
      font-size: 13px;
      color: var(--text);
    }

    .partner-status.show{
      display:block;
    }

    .partner-status.success{
      border-color: rgba(120,255,150,0.35);
      background: rgba(120,255,150,0.12);
    }

    .partner-status.error{
      border-color: rgba(255,120,120,0.35);
      background: rgba(255,120,120,0.12);
    }

    body[data-theme="light"] .field input::placeholder,
    body[data-theme="light"] .field textarea::placeholder{
      color: rgba(12,16,24,0.45);
    }

    .note{
      font-size: 12px;
      color: var(--muted);
    }

    .honeypot{
      position: absolute;
      left: -9999px;
      opacity: 0;
      pointer-events: none;
    }

    @media (min-width: 720px){
      .partner-grid{
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .info-grid{
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .toast{
      position: fixed;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.55);
      color: rgba(255,255,255,0.92);
      border: 1px solid rgba(255,255,255,0.14);
      backdrop-filter: blur(10px);
      padding: 10px 12px;
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      font-size: 13px;
      max-width: calc(100% - 24px);
      text-align:center;
      z-index:999;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="glow" aria-hidden="true"></div>

      <header>
        <div>
          <h1 id="pageTitle">Animal Match Studio</h1>
          <p class="sub" id="pageSub">
            Play with animal vibes, then grab a dinner idea for the mood.
          </p>
        </div>

        <!-- UPDATED BADGE (removed "index.html · offline OK") -->
        <div class="badge-stack">
          <div class="badge" id="badgeText" title="Animal match studio">Animal Match Studio</div>
          <button class="btn theme-btn" id="themeToggle" type="button" aria-label="Theme toggle">Light mode</button>
        </div>
      </header>

      <div class="panel">
        <nav class="site-nav" aria-label="Site navigation">
          <a href="#animalSection" id="navAnimal">Animal Match</a>
          <a href="#menuSection" id="navMenu">Dinner Ideas</a>
          <a href="#howSection" id="navHow">How it works</a>
          <a href="#privacySection" id="navPrivacy">Privacy</a>
          <a href="#faqSection" id="navFaq">FAQ</a>
          <a href="#contactSection" id="navContact">Contact</a>
        </nav>

        <section class="about" id="aboutSection" aria-label="About">
          <h2 id="aboutTitle">About this project</h2>
          <p id="aboutBody">
            Animal Match Studio is a playful demo that pairs a portrait photo with a fun animal vibe and suggests a cozy dinner to match the mood.
          </p>
        </section>

        <section class="feature" id="menuSection" aria-label="Dinner ideas">
          <div>
            <h2 id="menuTitle">Dinner ideas</h2>
            <p id="menuIntro">Pick one or more dishes from a curated list for quick inspiration.</p>
          </div>

          <div class="menu" id="menu" aria-live="polite" aria-label="Recommended menu">
            <span class="hint" id="hintText">Press the recommend button to get dinner ideas ✨</span>
          </div>

          <div class="controls">
            <div class="left-controls">
              <button class="btn primary" id="btnPick" type="button">Recommend</button>
              <button class="btn" id="btnCopy" type="button" disabled>Copy</button>
              <button class="btn" id="btnAgain" type="button" disabled>Try again</button>
            </div>

            <div class="opt" aria-label="Options">
              <label for="count" id="countLabel">Picks</label>
              <select id="count" aria-label="Pick count">
                <option value="1" selected>1 pick</option>
                <option value="2">2 picks</option>
                <option value="3">3 picks</option>
                <option value="5">5 picks</option>
                <option value="8">8 picks</option>
              </select>
              <label for="lang" id="langLabel">Language</label>
              <select id="lang" aria-label="Language">
                <option value="en" selected>English</option>
                <option value="zh">中文</option>
              </select>
            </div>
          </div>

          <div class="meta">
            <div id="metaText">Randomized from curated menu ideas.</div>
            <div id="last" class="mono">last: -</div>
          </div>
        </section>

        <hr class="divider" aria-hidden="true" />

        <section class="animal" id="animalSection" aria-label="Animal match test">
          <div class="animal-header">
          <div>
            <h2 id="animalTitle">Animal Match (Teachable Machine)</h2>
            <p id="animalIntro">Upload a portrait photo to see which animal vibe you match most.</p>
          </div>
          <div class="animal-status" id="animalStatus">Model not loaded</div>
        </div>

        <div class="animal-controls">
          <div class="field">
            <label for="modelUrl" id="modelUrlLabel">Model URL</label>
            <input id="modelUrl" type="url" placeholder="https://teachablemachine.withgoogle.com/models/XXXX/" />
          </div>
          <div class="animal-buttons">
            <button class="btn" id="modelLoad" type="button">Load model</button>
            <label class="btn primary" for="animalImage" id="animalPick">Choose photo</label>
            <input id="animalImage" type="file" accept="image/*" />
          </div>
        </div>

        <div class="animal-preview">
          <img id="animalPreview" alt="Photo preview for animal match" />
          <div class="animal-results" id="animalResults"></div>
        </div>

        <p class="note" id="animalNote">Tip: export an Image model from Teachable Machine and paste its model URL.</p>
      </section>

        <hr class="divider" aria-hidden="true" />

        <section class="info" id="howSection" aria-label="How it works">
          <h2 id="howTitle">How it works</h2>
          <div class="info-grid">
            <div class="info-card">
              <h3 id="howStep1Title">Load the model</h3>
              <p id="howStep1Body">Paste a Teachable Machine image model URL and we fetch the model in your browser.</p>
            </div>
            <div class="info-card">
              <h3 id="howStep2Title">Upload a portrait</h3>
              <p id="howStep2Body">Choose a clear photo for the best match results.</p>
            </div>
            <div class="info-card">
              <h3 id="howStep3Title">See the vibe</h3>
              <p id="howStep3Body">We show the top predictions so you can compare your animal matches.</p>
            </div>
          </div>
        </section>

        <section class="policy" id="privacySection" aria-label="Privacy and data">
          <h2 id="privacyTitle">Privacy & data</h2>
          <p id="privacyBody">We built this as a lightweight demo with privacy in mind.</p>
          <ul class="policy-list">
            <li id="privacyItem1">Images stay in your browser and are not uploaded to our server.</li>
            <li id="privacyItem2">We store only your chosen model URL and language preference in local storage.</li>
            <li id="privacyItem3">Clear your browser storage at any time to reset the experience.</li>
          </ul>
        </section>

        <section class="faq" id="faqSection" aria-label="Frequently asked questions">
          <h2 id="faqTitle">FAQ</h2>
          <ul class="faq-list">
            <li id="faqItem1">Is this scientific? No — it is just a fun demo using a custom-trained model.</li>
            <li id="faqItem2">Why do I need a model URL? The model is hosted by Teachable Machine, so we load it from there.</li>
            <li id="faqItem3">Does the app support mobile? Yes, it works on modern mobile browsers.</li>
          </ul>
        </section>

        <section class="partner" id="contactSection" aria-label="Contact form">
          <div>
            <h2 id="partnerTitle">Contact</h2>
            <p id="partnerIntro">Send a message about collaborations, feedback, or feature requests.</p>
          </div>

          <form class="partner-form" id="partnerForm" action="https://formspree.io/f/xqeeenqr" method="POST">
            <input class="honeypot" type="text" name="_gotcha" tabindex="-1" autocomplete="off" />
            <input type="hidden" name="_subject" id="partnerSubject" value="New contact message" />

            <div class="partner-grid">
              <div class="field">
                <label for="partnerName" id="partnerNameLabel">Name</label>
                <input id="partnerName" name="name" type="text" placeholder="Jane Park" required />
              </div>
              <div class="field">
                <label for="partnerEmail" id="partnerEmailLabel">Email</label>
                <input id="partnerEmail" name="email" type="email" placeholder="jane@studio.com" required />
              </div>
              <div class="field">
                <label for="partnerCompany" id="partnerCompanyLabel">Company</label>
                <input id="partnerCompany" name="company" type="text" placeholder="Studio Name" />
              </div>
              <div class="field">
                <label for="partnerWebsite" id="partnerWebsiteLabel">Website</label>
                <input id="partnerWebsite" name="website" type="url" placeholder="https://studio.com" />
              </div>
              <div class="field">
                <label for="partnerType" id="partnerTypeLabel">Topic</label>
                <select id="partnerType" name="partnership_type">
                  <option value="feedback" id="partnerTypeBrand">Feedback</option>
                  <option value="collab" id="partnerTypeSponsor">Collaboration</option>
                  <option value="support" id="partnerTypeAffiliate">Support</option>
                  <option value="press" id="partnerTypeContent">Press</option>
                  <option value="other" id="partnerTypeOther">Other</option>
                </select>
              </div>
              <div class="field">
                <label for="partnerTimeline" id="partnerTimelineLabel">When should we reply?</label>
                <input id="partnerTimeline" name="timeline" type="text" placeholder="This week, next month, not urgent" />
              </div>
            </div>

            <div class="field">
              <label for="partnerMessage" id="partnerMessageLabel">Message</label>
              <textarea id="partnerMessage" name="message" placeholder="Tell us what you need help with." required></textarea>
            </div>

            <div class="partner-actions">
              <button class="btn primary" id="partnerSubmit" type="submit">Send message</button>
              <span class="note" id="partnerNote">By submitting, you agree we can reply to your email.</span>
            </div>
            <div class="partner-status" id="partnerStatus" role="status" aria-live="polite"></div>
          </form>
        </section>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <script>
    const $menu = document.getElementById('menu');
    const $btnPick = document.getElementById('btnPick');
    const $btnCopy = document.getElementById('btnCopy');
    const $btnAgain = document.getElementById('btnAgain');
    const $count = document.getElementById('count');
    const $lang = document.getElementById('lang');
    const $last = document.getElementById('last');
    const $toast = document.getElementById('toast');
    const $themeToggle = document.getElementById('themeToggle');
    const $pageTitle = document.getElementById('pageTitle');
    const $pageSub = document.getElementById('pageSub');
    const $countLabel = document.getElementById('countLabel');
    const $langLabel = document.getElementById('langLabel');
    const $metaText = document.getElementById('metaText');
    const $badgeText = document.getElementById('badgeText');
    const $metaDesc = document.querySelector('meta[name="description"]');
    const $navAnimal = document.getElementById('navAnimal');
    const $navMenu = document.getElementById('navMenu');
    const $navHow = document.getElementById('navHow');
    const $navPrivacy = document.getElementById('navPrivacy');
    const $navFaq = document.getElementById('navFaq');
    const $navContact = document.getElementById('navContact');
    const $aboutTitle = document.getElementById('aboutTitle');
    const $aboutBody = document.getElementById('aboutBody');
    const $menuTitle = document.getElementById('menuTitle');
    const $menuIntro = document.getElementById('menuIntro');
    const $howTitle = document.getElementById('howTitle');
    const $howStep1Title = document.getElementById('howStep1Title');
    const $howStep1Body = document.getElementById('howStep1Body');
    const $howStep2Title = document.getElementById('howStep2Title');
    const $howStep2Body = document.getElementById('howStep2Body');
    const $howStep3Title = document.getElementById('howStep3Title');
    const $howStep3Body = document.getElementById('howStep3Body');
    const $privacyTitle = document.getElementById('privacyTitle');
    const $privacyBody = document.getElementById('privacyBody');
    const $privacyItem1 = document.getElementById('privacyItem1');
    const $privacyItem2 = document.getElementById('privacyItem2');
    const $privacyItem3 = document.getElementById('privacyItem3');
    const $faqTitle = document.getElementById('faqTitle');
    const $faqItem1 = document.getElementById('faqItem1');
    const $faqItem2 = document.getElementById('faqItem2');
    const $faqItem3 = document.getElementById('faqItem3');
    const $partnerTitle = document.getElementById('partnerTitle');
    const $partnerIntro = document.getElementById('partnerIntro');
    const $partnerSection = document.getElementById('contactSection');
    const $partnerNameLabel = document.getElementById('partnerNameLabel');
    const $partnerEmailLabel = document.getElementById('partnerEmailLabel');
    const $partnerCompanyLabel = document.getElementById('partnerCompanyLabel');
    const $partnerWebsiteLabel = document.getElementById('partnerWebsiteLabel');
    const $partnerTypeLabel = document.getElementById('partnerTypeLabel');
    const $partnerTimelineLabel = document.getElementById('partnerTimelineLabel');
    const $partnerMessageLabel = document.getElementById('partnerMessageLabel');
    const $partnerTypeBrand = document.getElementById('partnerTypeBrand');
    const $partnerTypeSponsor = document.getElementById('partnerTypeSponsor');
    const $partnerTypeAffiliate = document.getElementById('partnerTypeAffiliate');
    const $partnerTypeContent = document.getElementById('partnerTypeContent');
    const $partnerTypeOther = document.getElementById('partnerTypeOther');
    const $partnerSubmit = document.getElementById('partnerSubmit');
    const $partnerNote = document.getElementById('partnerNote');
    const $partnerSubject = document.getElementById('partnerSubject');
    const $partnerForm = document.getElementById('partnerForm');
    const $partnerStatus = document.getElementById('partnerStatus');
    const $partnerName = document.getElementById('partnerName');
    const $partnerEmail = document.getElementById('partnerEmail');
    const $partnerCompany = document.getElementById('partnerCompany');
    const $partnerWebsite = document.getElementById('partnerWebsite');
    const $partnerTimeline = document.getElementById('partnerTimeline');
    const $partnerMessage = document.getElementById('partnerMessage');
    const $animalTitle = document.getElementById('animalTitle');
    const $animalIntro = document.getElementById('animalIntro');
    const $animalStatus = document.getElementById('animalStatus');
    const $modelUrl = document.getElementById('modelUrl');
    const $modelLoad = document.getElementById('modelLoad');
    const $animalPick = document.getElementById('animalPick');
    const $animalImage = document.getElementById('animalImage');
    const $animalPreview = document.getElementById('animalPreview');
    const $animalResults = document.getElementById('animalResults');
    const $animalNote = document.getElementById('animalNote');
    const $modelUrlLabel = document.getElementById('modelUrlLabel');

    let lastResultText = "";
    let lastStamp = "-";
    let hasResults = false;
    let currentLang = "en";
    let lastItems = [];
    let tmModel = null;
    let tmMaxPredictions = 0;
    let animalStatusState = "idle";
    let lastAnimalPredictions = [];

    const i18n = {
      en: {
        title: "Animal Match Studio",
        subtitle: "Play with animal vibes, then grab a dinner idea for the mood.",
        hint: "Tap the recommend button to get dinner ideas ✨",
        pick: "Recommend",
        copy: "Copy",
        again: "Try again",
        countLabel: "Picks",
        langLabel: "Language",
        meta: "Randomized from curated dinner ideas.",
        badge: "Animal Match Studio",
        lastPrefix: "last:",
        themeLight: "Light mode",
        themeDark: "Dark mode",
        toastPick: "New dinner ideas ready!",
        toastAgain: "Another round served!",
        toastCopy: "Copied to clipboard!",
        promptCopy: "Copy and use:",
        ariaMenu: "Recommended menu",
        ariaCount: "Pick count",
        ariaLang: "Language",
        description: "Playful animal vibe matcher and dinner idea generator. Built with Teachable Machine, designed for quick inspiration.",
        navAnimal: "Animal Match",
        navMenu: "Dinner Ideas",
        navHow: "How it works",
        navPrivacy: "Privacy",
        navFaq: "FAQ",
        navContact: "Contact",
        aboutTitle: "About this project",
        aboutBody: "Animal Match Studio is a playful demo that pairs a portrait photo with a fun animal vibe and suggests a cozy dinner to match the mood.",
        menuTitle: "Dinner ideas",
        menuIntro: "Pick one or more dishes from a curated list for quick inspiration.",
        howTitle: "How it works",
        howStep1Title: "Load the model",
        howStep1Body: "Paste a Teachable Machine image model URL and we fetch the model in your browser.",
        howStep2Title: "Upload a portrait",
        howStep2Body: "Choose a clear photo for the best match results.",
        howStep3Title: "See the vibe",
        howStep3Body: "We show the top predictions so you can compare your animal matches.",
        privacyTitle: "Privacy & data",
        privacyBody: "We built this as a lightweight demo with privacy in mind.",
        privacyItem1: "Images stay in your browser and are not uploaded to our server.",
        privacyItem2: "We store only your chosen model URL and language preference in local storage.",
        privacyItem3: "Clear your browser storage at any time to reset the experience.",
        faqTitle: "FAQ",
        faqItem1: "Is this scientific? No — it is just a fun demo using a custom-trained model.",
        faqItem2: "Why do I need a model URL? The model is hosted by Teachable Machine, so we load it from there.",
        faqItem3: "Does the app support mobile? Yes, it works on modern mobile browsers.",
        partnerTitle: "Contact",
        partnerIntro: "Send a message about collaborations, feedback, or feature requests.",
        partnerAria: "Contact form",
        partnerName: "Name",
        partnerEmail: "Email",
        partnerCompany: "Company",
        partnerWebsite: "Website",
        partnerType: "Topic",
        partnerTimeline: "When should we reply?",
        partnerMessage: "Message",
        partnerTypeBrand: "Feedback",
        partnerTypeSponsor: "Collaboration",
        partnerTypeAffiliate: "Support",
        partnerTypeContent: "Press",
        partnerTypeOther: "Other",
        partnerSubmit: "Send message",
        partnerNote: "By submitting, you agree we can reply to your email.",
        partnerSubject: "New contact message",
        partnerPlaceholderName: "Jane Park",
        partnerPlaceholderEmail: "jane@studio.com",
        partnerPlaceholderCompany: "Studio Name",
        partnerPlaceholderWebsite: "https://studio.com",
        partnerPlaceholderTimeline: "This week, next month, not urgent",
        partnerPlaceholderMessage: "Tell us what you need help with.",
        partnerStatusSending: "Sending...",
        partnerStatusSuccess: "Thanks for reaching out! We will get back to you soon.",
        partnerStatusError: "Something went wrong. Please try again or email us directly.",
        animalTitle: "Animal Match (Teachable Machine)",
        animalIntro: "Upload a portrait photo to see which animal vibe you match most.",
        animalModelLabel: "Model URL",
        animalModelPlaceholder: "https://teachablemachine.withgoogle.com/models/XXXX/",
        animalLoad: "Load model",
        animalPick: "Choose photo",
        animalStatusIdle: "Model not loaded",
        animalStatusLoading: "Loading model...",
        animalStatusReady: "Model ready",
        animalStatusError: "Model load failed",
        animalNote: "Tip: export an Image model from Teachable Machine and paste its model URL.",
        animalResultTitle: "Top matches",
        animalToastNeedUrl: "Add a model URL first.",
        animalToastScriptFail: "Teachable Machine script failed to load.",
        animalToastReady: "Model ready!",
        animalToastLoadFail: "Model load failed.",
        animalToastNeedModel: "Load the model first.",
        optionLabel: (n) => `Option ${n}`,
        countOption: (n) => n === 1 ? "1 pick" : `${n} picks`
      },
      zh: {
        title: "动物匹配工作室",
        subtitle: "玩一玩动物气质匹配，再来一份晚餐灵感。",
        hint: "点击推荐按钮获取晚餐灵感 ✨",
        pick: "推荐菜单",
        copy: "复制",
        again: "再来一次",
        countLabel: "数量",
        langLabel: "语言",
        meta: "从精选晚餐中随机推荐。",
        badge: "动物匹配工作室",
        lastPrefix: "更新:",
        themeLight: "白色模式",
        themeDark: "深色模式",
        toastPick: "推荐已生成！",
        toastAgain: "新一轮推荐已送达！",
        toastCopy: "已复制到剪贴板！",
        promptCopy: "复制使用：",
        ariaMenu: "推荐菜单",
        ariaCount: "推荐数量",
        ariaLang: "语言",
        description: "基于 Teachable Machine 的趣味动物气质匹配与晚餐灵感生成器。",
        navAnimal: "动物匹配",
        navMenu: "晚餐灵感",
        navHow: "使用方式",
        navPrivacy: "隐私",
        navFaq: "常见问题",
        navContact: "联系我们",
        aboutTitle: "关于本项目",
        aboutBody: "动物匹配工作室是一个趣味示例，为人物照片匹配动物气质，并搭配一份晚餐灵感。",
        menuTitle: "晚餐灵感",
        menuIntro: "从精选列表中快速挑选一份或多份菜品。",
        howTitle: "使用方式",
        howStep1Title: "加载模型",
        howStep1Body: "粘贴 Teachable Machine 图像模型链接，在浏览器内加载。",
        howStep2Title: "上传照片",
        howStep2Body: "选择清晰的正面照片，效果更好。",
        howStep3Title: "查看结果",
        howStep3Body: "展示最高的预测结果，方便对比。",
        privacyTitle: "隐私与数据",
        privacyBody: "我们尽量保持轻量与隐私友好。",
        privacyItem1: "图片仅在浏览器内处理，不会上传到服务器。",
        privacyItem2: "仅在本地存储模型链接和语言偏好。",
        privacyItem3: "随时清除浏览器存储即可重置。",
        faqTitle: "常见问题",
        faqItem1: "这是否科学？不是，只是一个趣味模型演示。",
        faqItem2: "为什么需要模型链接？模型托管在 Teachable Machine，我们从那里加载。",
        faqItem3: "支持手机吗？支持主流移动浏览器。",
        partnerTitle: "联系我们",
        partnerIntro: "欢迎反馈、合作或功能建议。",
        partnerAria: "联系表单",
        partnerName: "姓名",
        partnerEmail: "邮箱",
        partnerCompany: "公司",
        partnerWebsite: "网站",
        partnerType: "主题",
        partnerTimeline: "希望何时回复",
        partnerMessage: "留言",
        partnerTypeBrand: "反馈",
        partnerTypeSponsor: "合作",
        partnerTypeAffiliate: "支持",
        partnerTypeContent: "媒体/新闻",
        partnerTypeOther: "其他",
        partnerSubmit: "发送消息",
        partnerNote: "提交即表示你同意我们通过邮件回复。",
        partnerSubject: "新的联系留言",
        partnerPlaceholderName: "王晓妍",
        partnerPlaceholderEmail: "xiaoyan@studio.cn",
        partnerPlaceholderCompany: "品牌名称",
        partnerPlaceholderWebsite: "https://studio.cn",
        partnerPlaceholderTimeline: "本周、下月、不着急",
        partnerPlaceholderMessage: "请告诉我们你的需求或建议。",
        partnerStatusSending: "发送中...",
        partnerStatusSuccess: "感谢联系！我们会尽快回复。",
        partnerStatusError: "提交失败，请重试或通过邮件联系。",
        animalTitle: "动物性格测试（Teachable Machine）",
        animalIntro: "上传一张人物照片，看看最像哪种动物。",
        animalModelLabel: "模型链接",
        animalModelPlaceholder: "https://teachablemachine.withgoogle.com/models/XXXX/",
        animalLoad: "加载模型",
        animalPick: "选择照片",
        animalStatusIdle: "模型未加载",
        animalStatusLoading: "加载模型中...",
        animalStatusReady: "模型已就绪",
        animalStatusError: "模型加载失败",
        animalNote: "提示：在 Teachable Machine 导出图像模型并粘贴模型链接。",
        animalResultTitle: "匹配结果",
        animalToastNeedUrl: "请先填写模型链接。",
        animalToastScriptFail: "Teachable Machine 脚本加载失败。",
        animalToastReady: "模型已就绪！",
        animalToastLoadFail: "模型加载失败。",
        animalToastNeedModel: "请先加载模型。",
        optionLabel: (n) => `选项 ${n}`,
        countOption: (n) => `${n}份`
      }
    };

    const menuItems = [
      { en: "Ginger scallion chicken", zh: "葱姜鸡" },
      { en: "Sichuan mapo tofu", zh: "麻婆豆腐" },
      { en: "Beef bibimbap", zh: "牛肉拌饭" },
      { en: "Mushroom risotto", zh: "蘑菇烩饭" },
      { en: "Grilled salmon with lemon", zh: "柠檬烤三文鱼" },
      { en: "Teriyaki chicken bowl", zh: "照烧鸡饭" },
      { en: "Spicy shrimp tacos", zh: "香辣虾塔可" },
      { en: "Braised pork belly", zh: "红烧五花肉" },
      { en: "Veggie curry with rice", zh: "蔬菜咖喱饭" },
      { en: "Tomato basil pasta", zh: "番茄罗勒意面" },
      { en: "Korean bulgogi bowl", zh: "韩式烤肉饭" },
      { en: "Garlic butter steak", zh: "蒜香黄油牛排" },
      { en: "Seafood udon", zh: "海鲜乌冬" },
      { en: "Chicken shawarma plate", zh: "鸡肉沙威玛拼盘" },
      { en: "Crispy tofu salad", zh: "香脆豆腐沙拉" },
      { en: "Thai green curry", zh: "泰式绿咖喱" },
      { en: "Kimchi fried rice", zh: "泡菜炒饭" },
      { en: "Vegetable bibimbap", zh: "素拌饭" },
      { en: "Lemon herb roast chicken", zh: "香草柠檬烤鸡" },
      { en: "Hot pot mix", zh: "火锅拼盘" },
      { en: "Pesto shrimp pasta", zh: "青酱虾意面" },
      { en: "BBQ pulled pork sandwich", zh: "手撕猪肉三明治" },
      { en: "Cantonese steamed fish", zh: "粤式清蒸鱼" },
      { en: "Chicken tikka masala", zh: "印度黄油鸡" }
    ];

    function toast(msg){
      $toast.textContent = msg;
      $toast.classList.add('show');
      clearTimeout(toast._t);
      toast._t = setTimeout(() => $toast.classList.remove('show'), 1400);
    }

    function applyTheme(theme){
      document.body.setAttribute('data-theme', theme);
      $themeToggle.textContent = theme === 'dark' ? i18n[currentLang].themeLight : i18n[currentLang].themeDark;
    }

    (function initTheme(){
      const stored = localStorage.getItem('theme');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initial = stored ? stored : (prefersDark ? 'dark' : 'light');
      applyTheme(initial);
    })();

    function nowStamp(){
      const d = new Date();
      const pad = (n) => String(n).padStart(2,'0');
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }

    // RNG: crypto if available, else Math.random
    function randInt(min, maxInclusive){
      const range = maxInclusive - min + 1;
      if (window.crypto && window.crypto.getRandomValues) {
        const maxUint = 0xFFFFFFFF;
        const limit = maxUint - (maxUint % range);
        const buf = new Uint32Array(1);
        let x;
        do {
          window.crypto.getRandomValues(buf);
          x = buf[0];
        } while (x >= limit);
        return min + (x % range);
      }
      return min + Math.floor(Math.random() * range);
    }

    function pickItems(count){
      const pool = menuItems.slice();
      for(let i = pool.length - 1; i > 0; i--){
        const j = randInt(0, i);
        [pool[i], pool[j]] = [pool[j], pool[i]];
      }
      return pool.slice(0, Math.min(count, pool.length));
    }

    function renderHint(){
      $menu.innerHTML = "";
      const hint = document.createElement('span');
      hint.className = "hint";
      hint.id = "hintText";
      hint.textContent = i18n[currentLang].hint;
      $menu.appendChild(hint);
    }

    function renderMenu(items){
      $menu.innerHTML = "";

      items.forEach((item, idx) => {
        const row = document.createElement('div');
        row.className = "setRow";

        const label = document.createElement('div');
        label.className = "setLabel";
        label.textContent = i18n[currentLang].optionLabel(idx + 1);
        row.appendChild(label);

        const dish = document.createElement('div');
        dish.className = "dish";
        dish.textContent = item[currentLang];
        row.appendChild(dish);

        $menu.appendChild(row);
      });
    }

    function itemsToText(items){
      return items.map((item, i) => `${i+1}) ${item[currentLang]}`).join('\n');
    }

    function applyLang(lang){
      currentLang = lang;
      localStorage.setItem('lang', lang);
      document.documentElement.lang = lang === 'zh' ? 'zh-Hans' : 'en';

      $pageTitle.textContent = i18n[lang].title;
      $pageSub.textContent = i18n[lang].subtitle;
      $btnPick.textContent = i18n[lang].pick;
      $btnCopy.textContent = i18n[lang].copy;
      $btnAgain.textContent = i18n[lang].again;
      $countLabel.textContent = i18n[lang].countLabel;
      $langLabel.textContent = i18n[lang].langLabel;
      $metaText.textContent = i18n[lang].meta;
      $badgeText.textContent = i18n[lang].badge;
      $menu.setAttribute('aria-label', i18n[lang].ariaMenu);
      $count.setAttribute('aria-label', i18n[lang].ariaCount);
      $lang.setAttribute('aria-label', i18n[lang].ariaLang);
      $last.textContent = `${i18n[currentLang].lastPrefix} ${lastStamp}`;
      document.title = i18n[lang].title;
      if ($metaDesc) {
        $metaDesc.setAttribute('content', i18n[lang].description);
      }
      if ($navAnimal) {
        $navAnimal.textContent = i18n[lang].navAnimal;
      }
      if ($navMenu) {
        $navMenu.textContent = i18n[lang].navMenu;
      }
      if ($navHow) {
        $navHow.textContent = i18n[lang].navHow;
      }
      if ($navPrivacy) {
        $navPrivacy.textContent = i18n[lang].navPrivacy;
      }
      if ($navFaq) {
        $navFaq.textContent = i18n[lang].navFaq;
      }
      if ($navContact) {
        $navContact.textContent = i18n[lang].navContact;
      }
      if ($aboutTitle) {
        $aboutTitle.textContent = i18n[lang].aboutTitle;
      }
      if ($aboutBody) {
        $aboutBody.textContent = i18n[lang].aboutBody;
      }
      if ($menuTitle) {
        $menuTitle.textContent = i18n[lang].menuTitle;
      }
      if ($menuIntro) {
        $menuIntro.textContent = i18n[lang].menuIntro;
      }
      if ($howTitle) {
        $howTitle.textContent = i18n[lang].howTitle;
      }
      if ($howStep1Title) {
        $howStep1Title.textContent = i18n[lang].howStep1Title;
      }
      if ($howStep1Body) {
        $howStep1Body.textContent = i18n[lang].howStep1Body;
      }
      if ($howStep2Title) {
        $howStep2Title.textContent = i18n[lang].howStep2Title;
      }
      if ($howStep2Body) {
        $howStep2Body.textContent = i18n[lang].howStep2Body;
      }
      if ($howStep3Title) {
        $howStep3Title.textContent = i18n[lang].howStep3Title;
      }
      if ($howStep3Body) {
        $howStep3Body.textContent = i18n[lang].howStep3Body;
      }
      if ($privacyTitle) {
        $privacyTitle.textContent = i18n[lang].privacyTitle;
      }
      if ($privacyBody) {
        $privacyBody.textContent = i18n[lang].privacyBody;
      }
      if ($privacyItem1) {
        $privacyItem1.textContent = i18n[lang].privacyItem1;
      }
      if ($privacyItem2) {
        $privacyItem2.textContent = i18n[lang].privacyItem2;
      }
      if ($privacyItem3) {
        $privacyItem3.textContent = i18n[lang].privacyItem3;
      }
      if ($faqTitle) {
        $faqTitle.textContent = i18n[lang].faqTitle;
      }
      if ($faqItem1) {
        $faqItem1.textContent = i18n[lang].faqItem1;
      }
      if ($faqItem2) {
        $faqItem2.textContent = i18n[lang].faqItem2;
      }
      if ($faqItem3) {
        $faqItem3.textContent = i18n[lang].faqItem3;
      }
      if ($partnerTitle) {
        $partnerTitle.textContent = i18n[lang].partnerTitle;
      }
      if ($partnerIntro) {
        $partnerIntro.textContent = i18n[lang].partnerIntro;
      }
      if ($partnerSection) {
        $partnerSection.setAttribute('aria-label', i18n[lang].partnerAria);
      }
      if ($partnerNameLabel) {
        $partnerNameLabel.textContent = i18n[lang].partnerName;
      }
      if ($partnerEmailLabel) {
        $partnerEmailLabel.textContent = i18n[lang].partnerEmail;
      }
      if ($partnerCompanyLabel) {
        $partnerCompanyLabel.textContent = i18n[lang].partnerCompany;
      }
      if ($partnerWebsiteLabel) {
        $partnerWebsiteLabel.textContent = i18n[lang].partnerWebsite;
      }
      if ($partnerTypeLabel) {
        $partnerTypeLabel.textContent = i18n[lang].partnerType;
      }
      if ($partnerTimelineLabel) {
        $partnerTimelineLabel.textContent = i18n[lang].partnerTimeline;
      }
      if ($partnerMessageLabel) {
        $partnerMessageLabel.textContent = i18n[lang].partnerMessage;
      }
      if ($partnerTypeBrand) {
        $partnerTypeBrand.textContent = i18n[lang].partnerTypeBrand;
      }
      if ($partnerTypeSponsor) {
        $partnerTypeSponsor.textContent = i18n[lang].partnerTypeSponsor;
      }
      if ($partnerTypeAffiliate) {
        $partnerTypeAffiliate.textContent = i18n[lang].partnerTypeAffiliate;
      }
      if ($partnerTypeContent) {
        $partnerTypeContent.textContent = i18n[lang].partnerTypeContent;
      }
      if ($partnerTypeOther) {
        $partnerTypeOther.textContent = i18n[lang].partnerTypeOther;
      }
      if ($partnerSubmit) {
        $partnerSubmit.textContent = i18n[lang].partnerSubmit;
      }
      if ($partnerNote) {
        $partnerNote.textContent = i18n[lang].partnerNote;
      }
      if ($partnerSubject) {
        $partnerSubject.value = i18n[lang].partnerSubject;
      }
      if ($partnerName) {
        $partnerName.placeholder = i18n[lang].partnerPlaceholderName;
      }
      if ($partnerEmail) {
        $partnerEmail.placeholder = i18n[lang].partnerPlaceholderEmail;
      }
      if ($partnerCompany) {
        $partnerCompany.placeholder = i18n[lang].partnerPlaceholderCompany;
      }
      if ($partnerWebsite) {
        $partnerWebsite.placeholder = i18n[lang].partnerPlaceholderWebsite;
      }
      if ($partnerTimeline) {
        $partnerTimeline.placeholder = i18n[lang].partnerPlaceholderTimeline;
      }
      if ($partnerMessage) {
        $partnerMessage.placeholder = i18n[lang].partnerPlaceholderMessage;
      }
      if ($animalTitle) {
        $animalTitle.textContent = i18n[lang].animalTitle;
      }
      if ($animalIntro) {
        $animalIntro.textContent = i18n[lang].animalIntro;
      }
      if ($modelUrlLabel) {
        $modelUrlLabel.textContent = i18n[lang].animalModelLabel;
      }
      if ($modelUrl) {
        $modelUrl.placeholder = i18n[lang].animalModelPlaceholder;
      }
      if ($modelLoad) {
        $modelLoad.textContent = i18n[lang].animalLoad;
      }
      if ($animalPick) {
        $animalPick.textContent = i18n[lang].animalPick;
      }
      if ($animalNote) {
        $animalNote.textContent = i18n[lang].animalNote;
      }

      Array.from($count.options).forEach((opt) => {
        const n = parseInt(opt.value, 10);
        opt.textContent = i18n[lang].countOption(n);
      });

      applyTheme(document.body.getAttribute('data-theme') || 'dark');

      if (!hasResults) {
        renderHint();
      } else {
        renderMenu(lastItems);
        lastResultText = itemsToText(lastItems);
        $last.textContent = `${i18n[currentLang].lastPrefix} ${lastStamp}`;
      }

      if (lastAnimalPredictions.length) {
        renderAnimalResults(lastAnimalPredictions);
      }
      setAnimalStatus(animalStatusState);
    }

    function setAnimalStatus(type){
      if (!$animalStatus) {
        return;
      }
      animalStatusState = type;
      const copy = {
        idle: i18n[currentLang].animalStatusIdle,
        loading: i18n[currentLang].animalStatusLoading,
        ready: i18n[currentLang].animalStatusReady,
        error: i18n[currentLang].animalStatusError
      };
      $animalStatus.textContent = copy[type] || copy.idle;
    }

    function normalizeModelUrl(url){
      if (!url) {
        return "";
      }
      return url.endsWith("/") ? url : `${url}/`;
    }

    async function loadAnimalModel(){
      if (!$modelUrl) {
        return;
      }
      const url = normalizeModelUrl($modelUrl.value.trim());
      if (!url) {
        setAnimalStatus("error");
        toast(i18n[currentLang].animalToastNeedUrl);
        return;
      }
      if (!window.tmImage || !window.tmImage.load) {
        setAnimalStatus("error");
        toast(i18n[currentLang].animalToastScriptFail);
        return;
      }
      try {
        setAnimalStatus("loading");
        tmModel = await window.tmImage.load(`${url}model.json`, `${url}metadata.json`);
        tmMaxPredictions = tmModel.getTotalClasses();
        localStorage.setItem('tm_model_url', url);
        setAnimalStatus("ready");
        toast(i18n[currentLang].animalToastReady);
        if ($animalPreview && $animalPreview.src) {
          predictAnimal();
        }
      } catch (err) {
        tmModel = null;
        tmMaxPredictions = 0;
        setAnimalStatus("error");
        toast(i18n[currentLang].animalToastLoadFail);
      }
    }

    function renderAnimalResults(predictions){
      if (!$animalResults) {
        return;
      }
      lastAnimalPredictions = predictions.slice();
      $animalResults.innerHTML = "";
      const title = document.createElement('div');
      title.className = "setLabel";
      title.textContent = i18n[currentLang].animalResultTitle;
      $animalResults.appendChild(title);

      predictions.forEach((pred) => {
        const row = document.createElement('div');
        row.className = "animal-result";

        const label = document.createElement('div');
        label.textContent = pred.className;
        row.appendChild(label);

        const bar = document.createElement('div');
        bar.className = "animal-bar";
        const fill = document.createElement('span');
        fill.style.width = `${Math.round(pred.probability * 100)}%`;
        bar.appendChild(fill);
        row.appendChild(bar);

        const pct = document.createElement('div');
        pct.textContent = `${Math.round(pred.probability * 100)}%`;
        row.appendChild(pct);

        $animalResults.appendChild(row);
      });
    }

    async function predictAnimal(){
      if (!tmModel || !$animalPreview) {
        return;
      }
      const predictions = await tmModel.predict($animalPreview, false);
      predictions.sort((a, b) => b.probability - a.probability);
      renderAnimalResults(predictions.slice(0, Math.min(5, tmMaxPredictions)));
    }

    function generate(){
      const count = parseInt($count.value, 10);
      const items = pickItems(count);
      hasResults = true;
      lastItems = items;

      renderMenu(items);

      lastResultText = itemsToText(items);
      $btnCopy.disabled = false;
      $btnAgain.disabled = false;

      lastStamp = nowStamp();
      $last.textContent = `${i18n[currentLang].lastPrefix} ${lastStamp}`;
    }

    $btnPick.addEventListener('click', () => {
      generate();
      toast(i18n[currentLang].toastPick);
    });

    $btnAgain.addEventListener('click', () => {
      generate();
      toast(i18n[currentLang].toastAgain);
    });

    $btnCopy.addEventListener('click', async () => {
      try{
        await navigator.clipboard.writeText(lastResultText);
        toast(i18n[currentLang].toastCopy);
      }catch(e){
        window.prompt(i18n[currentLang].promptCopy, lastResultText);
      }
    });

    $themeToggle.addEventListener('click', () => {
      const current = document.body.getAttribute('data-theme') || 'dark';
      const next = current === 'dark' ? 'light' : 'dark';
      applyTheme(next);
      localStorage.setItem('theme', next);
    });

    $lang.addEventListener('change', () => {
      applyLang($lang.value);
    });

    if ($animalImage) {
      $animalImage.addEventListener('change', async (event) => {
        const file = event.target.files && event.target.files[0];
        if (!file || !$animalPreview) {
          return;
        }
        if ($animalResults) {
          $animalResults.innerHTML = "";
        }
        lastAnimalPredictions = [];
        const url = URL.createObjectURL(file);
        $animalPreview.onload = () => {
          URL.revokeObjectURL(url);
          if (!tmModel) {
            toast(i18n[currentLang].animalToastNeedModel);
            return;
          }
          predictAnimal();
        };
        $animalPreview.src = url;
      });
    }

    if ($modelLoad) {
      $modelLoad.addEventListener('click', loadAnimalModel);
    }

    (function initAnimalModel(){
      const storedModel = localStorage.getItem('tm_model_url');
      const fallbackModel = "https://teachablemachine.withgoogle.com/models/A2USJBZAQ/";
      if ($modelUrl) {
        $modelUrl.value = storedModel || fallbackModel;
      }
      setAnimalStatus("idle");
      if ($modelUrl && $modelUrl.value.trim()) {
        loadAnimalModel();
      }
    })();

    if ($partnerForm) {
      $partnerForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        if ($partnerSubmit) {
          $partnerSubmit.disabled = true;
        }
        if ($partnerStatus) {
          $partnerStatus.className = "partner-status show";
          $partnerStatus.textContent = i18n[currentLang].partnerStatusSending;
        }
        try {
          const response = await fetch($partnerForm.action, {
            method: "POST",
            body: new FormData($partnerForm),
            headers: {
              Accept: "application/json"
            }
          });
          if (!response.ok) {
            throw new Error("Form submit failed");
          }
          if ($partnerStatus) {
            $partnerStatus.className = "partner-status show success";
            $partnerStatus.textContent = i18n[currentLang].partnerStatusSuccess;
          }
          $partnerForm.reset();
        } catch (err) {
          if ($partnerStatus) {
            $partnerStatus.className = "partner-status show error";
            $partnerStatus.textContent = i18n[currentLang].partnerStatusError;
          }
        } finally {
          if ($partnerSubmit) {
            $partnerSubmit.disabled = false;
          }
        }
      });
    }

    (function initLang(){
      const storedLang = localStorage.getItem('lang');
      const browserLang = navigator.language || '';
      const initialLang = storedLang || (browserLang.toLowerCase().startsWith('zh') ? 'zh' : 'en');
      $lang.value = initialLang;
      applyLang(initialLang);
    })();
  </script>
</body>
</html>
